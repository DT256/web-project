<header>
    <div class="header-top-area bg-gray text-center text-md-left"  style="background-color: white; font-weight: bold ">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-5">
                    <div class="header-call-action">
                        <a href="#">
                            <i class="fa fa-envelope"></i>
                            cnpm@laptop.com
                        </a>
                        <a href="#">
                            <i class="fa fa-phone"></i>
                            0123456789
                        </a>
                    </div>
                </div>
                <div class="col-lg-6 col-md-7">
                    <div class="header-top-right float-md-right float-none">
                        <nav>
                            <ul>
                                <!-- Hiển thị tên người dùng nếu đã đăng nhập -->
                                <li id="user-info" style="display: none;">
                                    <a id="user-name"></a>
                                    <a href="/logout">Đăng xuất</a>
                                </li>

                                <!-- Hiển thị đăng nhập và đăng ký nếu chưa đăng nhập -->
                                <li id="login-register">
                                    <a href="/login">Đăng nhập</a>
                                    <a href="/register">Đăng ký</a>
                                </li>
                            </ul>
                        </nav>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- header middle start -->
    <div class="header-middle-area pt-20 pb-20">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3">
                    <div class="brand-logo">
                        <a href="/">
                            <img th:src="@{/assets/img/logo/logo.png}" alt="brand logo">
                        </a>
                    </div>
                </div> <!-- end logo area -->
            </div>
        </div>
    </div>
    <!-- header middle end -->

    <!-- main menu area start -->
    <div class="main-header-wrapper bdr-bottom1">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="main-header-inner">
                        <div class="category-toggle-wrap">
                            <div class="category-toggle">
                                CNPM
                                <div class="cat-icon">
                                    <i class="fa fa-laptop"></i>
                                </div>
                            </div>

                        </div>
                        <div class="main-menu">
                            <nav id="mobile-menu">
                                <ul>
                                    <li class="active"><a th:href="@{/home}"><i class="fa fa-home"></i>Trang chủ </a></li>
                                    <li class="static"><a th:href="@{/products}">Sản phẩm</a></li>
                                    <li class="static" th:if="${session.roleName == 'Customer'}">
                                        <a th:href="@{/history}">Lịch sử mua hàng</a></li>
                                    <li th:if="${session.roleName == 'Admin'}">
                                        <a>Quản Lý Sản Phẩm</a>
                                        <ul class="dropdown">
                                            <li><a href="/admin/products">Sản Phẩm</a></li>
                                            <li><a href="/admin/manufacturers">Nhà Sản Xuất</a></li>
                                            <li><a href="/admin/categories">Thể Loại</a></li>
                                            <li><a href="/admin/inventory">Kho</a></li>
                                            <li><a href="/admin/rate-list">Phản hồi đánh giá</a></li>
                                            <li><a href="/admin/orders">Quản lý đơn hàng</a></li>
                                            <li><a href="/admin/customers">Quản lý khách hàng</a></li>
                                        </ul>
                                    </li>
                                    <li th:if="${session.roleName == 'Admin'}">
                                        <a th:href="@{/admin/dashboard}">Doanh Thu</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const token = localStorage.getItem('jwtToken');  // Lấy token từ localStorage

        // Khi người dùng click vào tên
        document.getElementById('user-name').addEventListener('click', function(event) {
            event.preventDefault();  // Ngăn chặn hành động mặc định (nếu có)

            if (token) {
                // Gửi yêu cầu Ajax đến API /personal-info
                fetch('/personal-info', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`  // Đính kèm token vào header
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Unauthorized or expired token');
                        }
                        return response.json(); // Giải mã dữ liệu trả về (giả sử trả về JSON)
                    })
                    .then(data => {
                        // Xử lý dữ liệu nhận được, hoặc chuyển hướng tới trang personal-info
                        window.location.href = '/personal-info';  // Chuyển hướng đến trang personal-info
                    })
                    .catch(error => {
                        console.error(error);
                    });

            } else {
                // Nếu không có token, yêu cầu người dùng đăng nhập
                window.location.href = '/login';
            }
        });

        document.addEventListener('DOMContentLoaded', () => {

            if (token) {
                try {
                    // Giải mã JWT
                    const decoded = jwt_decode(token);
                    const userName = decoded.name; // Thay 'name' bằng key chứa tên người dùng trong JWT

                    // Hiển thị tên người dùng
                    document.getElementById('user-name').innerText = userName;
                    document.getElementById('user-info').style.display = 'block';

                    // Ẩn phần đăng nhập/đăng ký
                    document.getElementById('login-register').style.display = 'none';
                } catch (error) {
                    console.error('Lỗi khi giải mã JWT:', error);
                }
            }
        });
    </script>

</header>
