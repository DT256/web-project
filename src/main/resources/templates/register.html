<!DOCTYPE html>
<html>
<head>
    <title>Sign Up</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h2>Sign Up</h2>

<form id="signupForm">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required><br>

    <label for="confirmPassword">Confirm Password:</label>
    <input type="password" id="confirmPassword" name="confirmPassword" required><br>

    <button type="submit">Sign Up</button>
</form>

<div id="otpForm" style="display:none;">
    <h3>Enter OTP sent to your email</h3>
    <label for="otp">OTP:</label>
    <input type="text" id="otp" name="otp" required><br>
    <button id="verifyOtpButton">Verify OTP</button>
</div>

<div id="signupError" style="color: red; display: none;"></div>
<div id="signupSuccess" style="color: green; display: none;"></div>

<script>
    $(document).ready(function() {
        // Handle sign-up form submission
        $('#signupForm').on('submit', function(e) {
            e.preventDefault();

            const name = $('#name').val();
            const email = $('#email').val();
            const password = $('#password').val();
            const confirmPassword = $('#confirmPassword').val();

            if (password !== confirmPassword) {
                $('#signupError').text('Passwords do not match.');
                $('#signupError').show();
                return;
            }

            // Send OTP before proceeding with sign-up
            $.ajax({
                type: 'POST',
                url: '/auth/send-otp',
                data: { email: email },
                success: function(response) {
                    $('#otpForm').show();
                    $('#signupSuccess').text(response).show();
                    $('#signupError').hide();
                },
                error: function(error) {
                    $('#signupError').text('Error sending OTP. Please try again.').show();
                    $('#signupSuccess').hide();
                }
            });
        });

        // Handle OTP verification
        $('#verifyOtpButton').on('click', function() {
            const email = $('#email').val();
            const otp = $('#otp').val();

            $.ajax({
                type: 'POST',
                url: '/auth/signup',
                contentType: 'application/json',
                data: JSON.stringify({ email: email, otp: otp, name: $('#name').val(), password: $('#password').val() }),
                success: function(response) {
                    $('#signupSuccess').text(response).show();
                    $('#signupError').hide();
                },
                error: function(error) {
                    $('#signupError').text('Invalid OTP. Please try again.').show();
                    $('#signupSuccess').hide();
                }
            });
        });
    });
</script>

</body>
</html>
